<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Make Post</title>
</head>
<body>
<h1>Make Post</h1>
<form id="postSubmissionForm" action="#" method="POST" enctype="multipart/form-data">
  <p>
    <label for="user_id">User Id:</label>
    <input type="text" id="user_id" name="user_id">
    <span style="color:red;">(TEMPORARY UNTIL LOGINS ARE WORKING)</span>
  </p>

  <p>
    <label for="title">Title:</label>
    <input type="text" id="title" name="title">
  </p>

  <p>
    <label for="body">Body:</label>
    <input type="text" id="body" name="body">
  </p>

  <p>
    <label for="img">Upload File:</label>
    <input type="file" id="img" name="img" accept="image/jpeg,image/png,image/heif">
  </p>

  <p>
    <input type="submit" value="Post" class="submit_button">
  </p>

</form>
<p id="output"></p>


<div id="tempNavBox">
  <a href="main.html">Main Page</a><br/>
</div>
</body>
<script>
  function doAJAXPOST(functionToRun, formData){
    // Initialize the HTTP request.
    let xhr = new XMLHttpRequest();
    xhr.open('POST', 'make_post.php');

    xhr.onreadystatechange = function () {
      if (xhr.readyState === 4 && xhr.status === 200) { // 4 means the request is finished, 200 means the request was successful
        //execute the given function once the response is received
        functionToRun(xhr.responseText);
      }
    }

    // Send the request

    xhr.send(formData);
  }

  document.getElementById("postSubmissionForm").addEventListener("submit",

  function(evt) {
    evt.preventDefault();
    document.getElementById("output").innerHTML = "Posting..."

    let formData = new FormData();
    formData.append("user_id", document.getElementById("user_id").value);
    formData.append("title", document.getElementById("title").value);
    formData.append("body", document.getElementById("body").value);

    let imgFile = document.getElementById("img").files[0]
    formData.append("img", imgFile, imgFile.name);


    function showResult(text) {
      if(text === "1") {
        document.getElementById("output").innerHTML = "Success!";
      } else {
        document.getElementById("output").innerHTML = "Failed.";
      }

    }

    doAJAXPOST(showResult, formData);
  }

  );



</script>
</html>