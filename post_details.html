<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title id="post_title"></title>
</head>
<body>
<a href="home.html">Back to home</a><br/>
<div id="post_header"></div>
<div id="post_image"></div>
<div id="comments">
<p>Comments</p>
</div>

</body>

<script>
  var url = decodeURIComponent(window.location.href),
  regex = new RegExp("[?&]" + "post_id" + "=([^&#]*)"),
  match = regex.exec(url),
  post_id = match ? match[1] : "",

  parse = function(data) { return JSON.parse(data.responseText) };

  document.getElementById("post_image").innerHTML = "<img onerror='this.style.display=\"none\"' src='fetch_img.php?id=" + post_id + "'><br>";

  http = new XMLHttpRequest();
  http.open("GET", "get_post.php?id=" + post_id);
  http.onreadystatechange = function() {

    if (http.readyState == 4 && http.status == 200) {
      parsed_data = parse(http);

      if((parsed_data.username == "Anonymous"))
        document.getElementById("post_title").textContent = "Anonymous Post";
      else
        document.getElementById("post_title").textContent = parsed_data.username + "'s Post";

      document.getElementById("post_header").innerHTML = "<p>" + parsed_data.username + "    " + parsed_data.timestamp + "</p><p>" + parsed_data.title + "</p>";

      for(let i=0; parsed_data.comments.length; i++)
        document.getElementById("comments").innerHTML += "<p>" + parsed_data.comments[i].username + " | "
                + parsed_data.comments[i].text + " | " + parsed_data.comments[i].timestamp + "</p>";

      }
  };
  http.send();


</script>
</html>